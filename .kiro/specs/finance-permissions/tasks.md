# Implementation Plan

- [ ] 1. 创建权限配置基础设施
  - 创建 TypeScript 类型定义和接口
  - 实现 Directus API 客户端封装
  - 实现错误处理和重试机制
  - _Requirements: 4.1, 4.4_

- [ ] 2. 实现权限规则定义
- [ ] 2.1 定义业主角色权限规则
  - 创建业主角色的所有财务表读权限规则
  - 配置基于 `owner_id` 的数据过滤
  - 配置基于 `community_id` 的社区数据访问
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5_

- [ ] 2.2 定义物业管理员角色权限规则
  - 创建物业管理员的所有财务表 CRUD 权限规则
  - 配置基于 `community_id` 的社区数据隔离
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5_

- [ ] 2.3 定义业委会成员角色权限规则
  - 创建业委会成员的所有财务表读权限规则
  - 配置支出和维修基金审批的更新权限
  - 限制可更新的字段为审批相关字段
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5_

- [ ] 3. 实现权限配置脚本
- [ ] 3.1 实现角色管理功能
  - 实现检查角色是否存在的方法
  - 实现创建角色的方法
  - 实现获取角色 ID 的方法
  - _Requirements: 4.1, 4.3_

- [ ] 3.2 实现权限规则配置功能
  - 实现单个权限规则的创建/更新方法
  - 实现批量权限规则配置方法
  - 处理权限冲突（更新现有规则）
  - _Requirements: 4.1, 4.4_

- [ ] 3.3 实现主配置流程
  - 实现遍历所有角色配置的主流程
  - 实现配置结果输出和日志记录
  - 添加命令行参数支持（指定角色、环境等）
  - _Requirements: 4.1, 4.2_

- [ ] 4. 实现权限验证脚本
- [ ] 4.1 实现验证测试框架
  - 创建测试用例数据结构
  - 实现单个测试用例的执行方法
  - 实现测试结果收集和报告
  - _Requirements: 5.1, 5.5_

- [ ] 4.2 定义验证测试用例
  - 创建业主角色的验证测试用例
  - 创建物业管理员角色的验证测试用例
  - 创建业委会成员角色的验证测试用例
  - _Requirements: 5.2, 5.3, 5.4_

- [ ] 4.3 实现测试执行和报告
  - 实现批量测试执行
  - 实现测试结果格式化输出
  - 实现失败测试的详细错误信息
  - _Requirements: 5.1, 5.5_

- [ ] 5. 创建配置和文档
- [ ] 5.1 创建环境配置文件
  - 创建 `.env.example` 模板文件
  - 添加必要的环境变量说明
  - 创建不同环境的配置示例
  - _Requirements: 4.1_

- [ ] 5.2 创建 npm 脚本
  - 在 `package.json` 中添加 `configure:permissions` 脚本
  - 在 `package.json` 中添加 `verify:permissions` 脚本
  - 添加开发和生产环境的不同脚本
  - _Requirements: 4.1, 4.2_

- [ ] 5.3 编写使用文档
  - 创建权限配置使用指南
  - 添加常见问题和故障排除
  - 添加权限规则自定义说明
  - _Requirements: 4.2, 4.5_

- [ ] 6. 集成和测试
- [ ] 6.1 在开发环境测试
  - 执行权限配置脚本
  - 执行权限验证脚本
  - 验证所有测试用例通过
  - _Requirements: 5.1, 5.2, 5.3, 5.4_

- [ ] 6.2 修复前端应用的权限问题
  - 确保前端应用正确传递 Authorization 头
  - 验证业主可以访问自己的账单页面
  - 验证物业管理员可以访问管理页面
  - _Requirements: 1.1, 2.1_

- [ ] 6.3 端到端测试
  - 使用不同角色的用户登录测试
  - 验证数据访问权限符合预期
  - 验证跨社区数据隔离正常工作
  - _Requirements: 1.5, 5.2, 5.3, 5.4_
