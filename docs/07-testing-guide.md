# ÊµãËØïÊåáÂçó

> ÂÖ®Èù¢ÁöÑÊµãËØïÁ≠ñÁï•„ÄÅÂ∑•ÂÖ∑ÈÖçÁΩÆÂíåÊúÄ‰Ω≥ÂÆûË∑µ

## üéØ ÊµãËØïÁ≠ñÁï•Ê¶ÇËßà

### ÊµãËØïÈáëÂ≠óÂ°î

```mermaid
pyramid
  title ÊµãËØïÈáëÂ≠óÂ°î
  top "E2E ÊµãËØï"
    "ÈõÜÊàêÊµãËØï"
      "ÂçïÂÖÉÊµãËØï"
```

| ÊµãËØïÁ±ªÂûã | Âç†ÊØî | ÁâπÁÇπ | Â∑•ÂÖ∑ |
|---------|------|------|------|
| ÂçïÂÖÉÊµãËØï | 70% | Âø´ÈÄü„ÄÅÈöîÁ¶ª„ÄÅÂèØÈù† | Vitest, Jest |
| ÈõÜÊàêÊµãËØï | 20% | Ê®°ÂùóÈó¥‰∫§‰∫í | Vue Test Utils |
| E2E ÊµãËØï | 10% | Áî®Êà∑Âú∫ÊôØÈ™åËØÅ | Playwright, Cypress |

### ÊµãËØïË¶ÜÁõñÁõÆÊ†á

- **‰ª£Á†ÅË¶ÜÁõñÁéá**: ‚â• 80%
- **ÂàÜÊîØË¶ÜÁõñÁéá**: ‚â• 75%
- **ÂáΩÊï∞Ë¶ÜÁõñÁéá**: ‚â• 90%
- **Ë°åË¶ÜÁõñÁéá**: ‚â• 85%

---

## üîß ÊµãËØïÁéØÂ¢ÉÈÖçÁΩÆ

### 1. Vitest ÈÖçÁΩÆ

```typescript
// vitest.config.ts
import { defineConfig } from 'vitest/config'
import vue from '@vitejs/plugin-vue'
import { resolve } from 'path'

export default defineConfig({
  plugins: [vue()],
  test: {
    // ÊµãËØïÁéØÂ¢É
    environment: 'jsdom',
    
    // ÂÖ®Â±ÄÈÖçÁΩÆ
    globals: true,
    
    // ËÆæÁΩÆÊñá‰ª∂
    setupFiles: ['./tests/setup.ts'],
    
    // Ë¶ÜÁõñÁéáÈÖçÁΩÆ
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html'],
      exclude: [
        'node_modules/',
        'tests/',
        '**/*.d.ts',
        '**/*.config.*',
        'dist/'
      ],
      thresholds: {
        global: {
          branches: 75,
          functions: 90,
          lines: 85,
          statements: 85
        }
      }
    },
    
    // ÊµãËØïÊñá‰ª∂ÂåπÈÖç
    include: [
      'tests/**/*.{test,spec}.{js,ts}',
      'src/**/__tests__/*.{test,spec}.{js,ts}'
    ],
    
    // ÊéíÈô§Êñá‰ª∂
    exclude: [
      'node_modules',
      'dist',
      '.idea',
      '.git',
      '.cache'
    ]
  },
  
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
      '@tests': resolve(__dirname, 'tests')
    }
  }
})
```

### 2. ÊµãËØïËÆæÁΩÆÊñá‰ª∂

```typescript
// tests/setup.ts
import { vi } from 'vitest'
import { config } from '@vue/test-utils'

// ÂÖ®Â±ÄÊµãËØïÈÖçÁΩÆ
config.global.plugins = []

// Mock uni-app API
const mockUni = {
  showToast: vi.fn(),
  showModal: vi.fn(),
  navigateTo: vi.fn(),
  redirectTo: vi.fn(),
  switchTab: vi.fn(),
  navigateBack: vi.fn(),
  request: vi.fn(),
  uploadFile: vi.fn(),
  downloadFile: vi.fn(),
  getStorageSync: vi.fn(),
  setStorageSync: vi.fn(),
  removeStorageSync: vi.fn(),
  clearStorageSync: vi.fn()
}

// ÂÖ®Â±Ä uni ÂØπË±°
global.uni = mockUni

// Mock console ÊñπÊ≥ïÔºàÂèØÈÄâÔºâ
global.console = {
  ...console,
  // Âú®ÊµãËØï‰∏≠ÈùôÈªòÊüê‰∫õÊó•Âøó
  log: vi.fn(),
  debug: vi.fn(),
  info: vi.fn(),
  warn: vi.fn(),
  error: vi.fn()
}

// Ê∏ÖÁêÜÂáΩÊï∞
afterEach(() => {
  vi.clearAllMocks()
})
```

### 3. ÊµãËØïÂ∑•ÂÖ∑ÂáΩÊï∞

```typescript
// tests/utils/test-utils.ts
import { mount, VueWrapper } from '@vue/test-utils'
import { createPinia } from 'pinia'
import { Component } from 'vue'

// ÂàõÂª∫ÊµãËØïÁî®ÁöÑ Pinia ÂÆû‰æã
export function createTestPinia() {
  return createPinia()
}

// ÊåÇËΩΩÁªÑ‰ª∂ÁöÑËæÖÂä©ÂáΩÊï∞
export function mountComponent(component: Component, options: any = {}) {
  const pinia = createTestPinia()
  
  return mount(component, {
    global: {
      plugins: [pinia],
      stubs: {
        // Â≠òÊ†π‰∏çÈúÄË¶ÅÊµãËØïÁöÑÁªÑ‰ª∂
        'router-link': true,
        'router-view': true
      }
    },
    ...options
  })
}

// Á≠âÂæÖÂºÇÊ≠•Êìç‰ΩúÂÆåÊàê
export async function flushPromises() {
  return new Promise(resolve => setTimeout(resolve, 0))
}

// Ê®°ÊãüÁî®Êà∑‰∫§‰∫í
export class UserInteraction {
  constructor(private wrapper: VueWrapper<any>) {}
  
  async click(selector: string) {
    const element = this.wrapper.find(selector)
    await element.trigger('click')
    await flushPromises()
    return this
  }
  
  async input(selector: string, value: string) {
    const element = this.wrapper.find(selector)
    await element.setValue(value)
    await flushPromises()
    return this
  }
  
  async submit(selector: string = 'form') {
    const form = this.wrapper.find(selector)
    await form.trigger('submit')
    await flushPromises()
    return this
  }
}

export function createUserInteraction(wrapper: VueWrapper<any>) {
  return new UserInteraction(wrapper)
}
```

---

## üß™ ÂçïÂÖÉÊµãËØï

### 1. ÁªÑ‰ª∂ÊµãËØï

```typescript
// tests/components/Button.test.ts
import { describe, it, expect, vi } from 'vitest'
import { mountComponent, createUserInteraction } from '@tests/utils/test-utils'
import Button from '@/components/base/Button.vue'

describe('Button ÁªÑ‰ª∂', () => {
  it('Â∫îËØ•Ê≠£Á°ÆÊ∏≤ÊüìÊåâÈíÆÊñáÊú¨', () => {
    const wrapper = mountComponent(Button, {
      props: {
        text: 'ÁÇπÂáªÊàë'
      }
    })
    
    expect(wrapper.text()).toBe('ÁÇπÂáªÊàë')
  })
  
  it('Â∫îËØ•Âú®ÁÇπÂáªÊó∂Ëß¶Âèë‰∫ã‰ª∂', async () => {
    const onClick = vi.fn()
    const wrapper = mountComponent(Button, {
      props: {
        text: 'ÁÇπÂáªÊàë',
        onClick
      }
    })
    
    const interaction = createUserInteraction(wrapper)
    await interaction.click('button')
    
    expect(onClick).toHaveBeenCalledTimes(1)
  })
  
  it('Â∫îËØ•Âú®Á¶ÅÁî®Áä∂ÊÄÅ‰∏ã‰∏çËß¶Âèë‰∫ã‰ª∂', async () => {
    const onClick = vi.fn()
    const wrapper = mountComponent(Button, {
      props: {
        text: 'ÁÇπÂáªÊàë',
        disabled: true,
        onClick
      }
    })
    
    const interaction = createUserInteraction(wrapper)
    await interaction.click('button')
    
    expect(onClick).not.toHaveBeenCalled()
    expect(wrapper.find('button').attributes('disabled')).toBeDefined()
  })
  
  it('Â∫îËØ•Ê≠£Á°ÆÂ∫îÁî®‰∏çÂêåÁöÑÊåâÈíÆÁ±ªÂûãÊ†∑Âºè', () => {
    const types = ['primary', 'secondary', 'danger']
    
    types.forEach(type => {
      const wrapper = mountComponent(Button, {
        props: {
          text: 'ÊåâÈíÆ',
          type
        }
      })
      
      expect(wrapper.find('button').classes()).toContain(`btn-${type}`)
    })
  })
  
  it('Â∫îËØ•ÊîØÊåÅÂä†ËΩΩÁä∂ÊÄÅ', () => {
    const wrapper = mountComponent(Button, {
      props: {
        text: 'Êèê‰∫§',
        loading: true
      }
    })
    
    expect(wrapper.find('.loading-icon').exists()).toBe(true)
    expect(wrapper.find('button').attributes('disabled')).toBeDefined()
  })
})
```

### 2. Composables ÊµãËØï

```typescript
// tests/composables/useCounter.test.ts
import { describe, it, expect } from 'vitest'
import { useCounter } from '@/composables/useCounter'

describe('useCounter', () => {
  it('Â∫îËØ•ÂàùÂßãÂåñ‰∏∫ÈªòËÆ§ÂÄº', () => {
    const { count, increment, decrement, reset } = useCounter()
    
    expect(count.value).toBe(0)
  })
  
  it('Â∫îËØ•ÂàùÂßãÂåñ‰∏∫ÊåáÂÆöÂÄº', () => {
    const { count } = useCounter(10)
    
    expect(count.value).toBe(10)
  })
  
  it('Â∫îËØ•Ê≠£Á°ÆÈÄíÂ¢û', () => {
    const { count, increment } = useCounter(5)
    
    increment()
    expect(count.value).toBe(6)
    
    increment(3)
    expect(count.value).toBe(9)
  })
  
  it('Â∫îËØ•Ê≠£Á°ÆÈÄíÂáè', () => {
    const { count, decrement } = useCounter(10)
    
    decrement()
    expect(count.value).toBe(9)
    
    decrement(4)
    expect(count.value).toBe(5)
  })
  
  it('Â∫îËØ•Ê≠£Á°ÆÈáçÁΩÆ', () => {
    const { count, increment, reset } = useCounter(0)
    
    increment(5)
    expect(count.value).toBe(5)
    
    reset()
    expect(count.value).toBe(0)
  })
  
  it('Â∫îËØ•ÊîØÊåÅÊúÄÂ∞èÂÄºÈôêÂà∂', () => {
    const { count, decrement } = useCounter(0, { min: 0 })
    
    decrement(5)
    expect(count.value).toBe(0)
  })
  
  it('Â∫îËØ•ÊîØÊåÅÊúÄÂ§ßÂÄºÈôêÂà∂', () => {
    const { count, increment } = useCounter(8, { max: 10 })
    
    increment(5)
    expect(count.value).toBe(10)
  })
})
```

### 3. Store ÊµãËØï

```typescript
// tests/stores/user.test.ts
import { describe, it, expect, beforeEach, vi } from 'vitest'
import { setActivePinia, createPinia } from 'pinia'
import { useUserStore } from '@/stores/user'
import * as userApi from '@/api/user'

// Mock API
vi.mock('@/api/user', () => ({
  getUserInfo: vi.fn(),
  updateUserInfo: vi.fn(),
  login: vi.fn(),
  logout: vi.fn()
}))

describe('User Store', () => {
  beforeEach(() => {
    setActivePinia(createPinia())
    vi.clearAllMocks()
  })
  
  it('Â∫îËØ•ÂàùÂßãÂåñ‰∏∫ÈªòËÆ§Áä∂ÊÄÅ', () => {
    const store = useUserStore()
    
    expect(store.userInfo).toBeNull()
    expect(store.isLoggedIn).toBe(false)
    expect(store.loading).toBe(false)
  })
  
  it('Â∫îËØ•Ê≠£Á°ÆÂ§ÑÁêÜÁôªÂΩï', async () => {
    const mockUserInfo = {
      id: '1',
      name: 'Âº†‰∏â',
      email: 'zhangsan@example.com'
    }
    
    vi.mocked(userApi.login).mockResolvedValue({
      code: 200,
      data: {
        token: 'mock-token',
        userInfo: mockUserInfo
      }
    })
    
    const store = useUserStore()
    await store.login('zhangsan@example.com', 'password')
    
    expect(store.userInfo).toEqual(mockUserInfo)
    expect(store.isLoggedIn).toBe(true)
    expect(userApi.login).toHaveBeenCalledWith('zhangsan@example.com', 'password')
  })
  
  it('Â∫îËØ•Ê≠£Á°ÆÂ§ÑÁêÜÁôªÂΩïÂ§±Ë¥•', async () => {
    vi.mocked(userApi.login).mockRejectedValue(new Error('ÁôªÂΩïÂ§±Ë¥•'))
    
    const store = useUserStore()
    
    await expect(store.login('wrong@example.com', 'wrong')).rejects.toThrow('ÁôªÂΩïÂ§±Ë¥•')
    expect(store.userInfo).toBeNull()
    expect(store.isLoggedIn).toBe(false)
  })
  
  it('Â∫îËØ•Ê≠£Á°ÆÂ§ÑÁêÜÁôªÂá∫', async () => {
    const store = useUserStore()
    
    // ÂÖàËÆæÁΩÆÁôªÂΩïÁä∂ÊÄÅ
    store.userInfo = {
      id: '1',
      name: 'Âº†‰∏â',
      email: 'zhangsan@example.com'
    }
    
    await store.logout()
    
    expect(store.userInfo).toBeNull()
    expect(store.isLoggedIn).toBe(false)
    expect(userApi.logout).toHaveBeenCalled()
  })
  
  it('Â∫îËØ•Ê≠£Á°ÆÊõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØ', async () => {
    const updatedInfo = {
      id: '1',
      name: 'ÊùéÂõõ',
      email: 'lisi@example.com'
    }
    
    vi.mocked(userApi.updateUserInfo).mockResolvedValue({
      code: 200,
      data: updatedInfo
    })
    
    const store = useUserStore()
    await store.updateUserInfo(updatedInfo)
    
    expect(store.userInfo).toEqual(updatedInfo)
    expect(userApi.updateUserInfo).toHaveBeenCalledWith(updatedInfo)
  })
})
```

### 4. Â∑•ÂÖ∑ÂáΩÊï∞ÊµãËØï

```typescript
// tests/utils/format.test.ts
import { describe, it, expect } from 'vitest'
import { formatDate, formatCurrency, formatFileSize } from '@/utils/format'

describe('Ê†ºÂºèÂåñÂ∑•ÂÖ∑ÂáΩÊï∞', () => {
  describe('formatDate', () => {
    it('Â∫îËØ•Ê≠£Á°ÆÊ†ºÂºèÂåñÊó•Êúü', () => {
      const date = new Date('2024-01-15T10:30:00')
      
      expect(formatDate(date)).toBe('2024-01-15')
      expect(formatDate(date, 'YYYY-MM-DD HH:mm')).toBe('2024-01-15 10:30')
      expect(formatDate(date, 'MM/DD/YYYY')).toBe('01/15/2024')
    })
    
    it('Â∫îËØ•Â§ÑÁêÜÊó†ÊïàÊó•Êúü', () => {
      expect(formatDate(null)).toBe('')
      expect(formatDate(undefined)).toBe('')
      expect(formatDate('invalid')).toBe('')
    })
  })
  
  describe('formatCurrency', () => {
    it('Â∫îËØ•Ê≠£Á°ÆÊ†ºÂºèÂåñË¥ßÂ∏Å', () => {
      expect(formatCurrency(1234.56)).toBe('¬•1,234.56')
      expect(formatCurrency(0)).toBe('¬•0.00')
      expect(formatCurrency(1000000)).toBe('¬•1,000,000.00')
    })
    
    it('Â∫îËØ•ÊîØÊåÅ‰∏çÂêåË¥ßÂ∏ÅÁ¨¶Âè∑', () => {
      expect(formatCurrency(100, '$')).toBe('$100.00')
      expect(formatCurrency(100, '‚Ç¨')).toBe('‚Ç¨100.00')
    })
    
    it('Â∫îËØ•Â§ÑÁêÜÊó†ÊïàÊï∞ÂÄº', () => {
      expect(formatCurrency(null)).toBe('¬•0.00')
      expect(formatCurrency(undefined)).toBe('¬•0.00')
      expect(formatCurrency('invalid')).toBe('¬•0.00')
    })
  })
  
  describe('formatFileSize', () => {
    it('Â∫îËØ•Ê≠£Á°ÆÊ†ºÂºèÂåñÊñá‰ª∂Â§ßÂ∞è', () => {
      expect(formatFileSize(0)).toBe('0 B')
      expect(formatFileSize(1024)).toBe('1.00 KB')
      expect(formatFileSize(1048576)).toBe('1.00 MB')
      expect(formatFileSize(1073741824)).toBe('1.00 GB')
    })
    
    it('Â∫îËØ•ÊîØÊåÅËá™ÂÆö‰πâÁ≤æÂ∫¶', () => {
      expect(formatFileSize(1536, 1)).toBe('1.5 KB')
      expect(formatFileSize(1536, 0)).toBe('2 KB')
    })
  })
})
```

---

## üîó ÈõÜÊàêÊµãËØï

### 1. È°µÈù¢ÈõÜÊàêÊµãËØï

```typescript
// tests/pages/UserProfile.test.ts
import { describe, it, expect, beforeEach, vi } from 'vitest'
import { mountComponent, createUserInteraction, flushPromises } from '@tests/utils/test-utils'
import UserProfile from '@/pages/user/profile/index.vue'
import * as userApi from '@/api/user'

vi.mock('@/api/user')

describe('Áî®Êà∑ËµÑÊñôÈ°µÈù¢', () => {
  const mockUserInfo = {
    id: '1',
    name: 'Âº†‰∏â',
    email: 'zhangsan@example.com',
    avatar: 'https://example.com/avatar.jpg',
    phone: '13800138000'
  }
  
  beforeEach(() => {
    vi.mocked(userApi.getUserInfo).mockResolvedValue({
      code: 200,
      data: mockUserInfo
    })
  })
  
  it('Â∫îËØ•Ê≠£Á°ÆÂä†ËΩΩÂíåÊòæÁ§∫Áî®Êà∑‰ø°ÊÅØ', async () => {
    const wrapper = mountComponent(UserProfile)
    
    // Á≠âÂæÖÂºÇÊ≠•Êï∞ÊçÆÂä†ËΩΩ
    await flushPromises()
    
    expect(wrapper.find('[data-testid="user-name"]').text()).toBe('Âº†‰∏â')
    expect(wrapper.find('[data-testid="user-email"]').text()).toBe('zhangsan@example.com')
    expect(wrapper.find('[data-testid="user-phone"]').text()).toBe('13800138000')
  })
  
  it('Â∫îËØ•ÊîØÊåÅÁºñËæëÁî®Êà∑‰ø°ÊÅØ', async () => {
    vi.mocked(userApi.updateUserInfo).mockResolvedValue({
      code: 200,
      data: { ...mockUserInfo, name: 'ÊùéÂõõ' }
    })
    
    const wrapper = mountComponent(UserProfile)
    await flushPromises()
    
    const interaction = createUserInteraction(wrapper)
    
    // ÁÇπÂáªÁºñËæëÊåâÈíÆ
    await interaction.click('[data-testid="edit-button"]')
    
    // ‰øÆÊîπÂßìÂêç
    await interaction.input('[data-testid="name-input"]', 'ÊùéÂõõ')
    
    // Êèê‰∫§Ë°®Âçï
    await interaction.click('[data-testid="save-button"]')
    
    expect(userApi.updateUserInfo).toHaveBeenCalledWith({
      ...mockUserInfo,
      name: 'ÊùéÂõõ'
    })
  })
  
  it('Â∫îËØ•Â§ÑÁêÜÂä†ËΩΩÈîôËØØ', async () => {
    vi.mocked(userApi.getUserInfo).mockRejectedValue(new Error('ÁΩëÁªúÈîôËØØ'))
    
    const wrapper = mountComponent(UserProfile)
    await flushPromises()
    
    expect(wrapper.find('[data-testid="error-message"]').exists()).toBe(true)
    expect(wrapper.find('[data-testid="error-message"]').text()).toContain('Âä†ËΩΩÂ§±Ë¥•')
  })
})
```

### 2. API ÈõÜÊàêÊµãËØï

```typescript
// tests/api/user.test.ts
import { describe, it, expect, beforeEach, vi } from 'vitest'
import { getUserInfo, updateUserInfo, login } from '@/api/user'
import { request } from '@/utils/request'

vi.mock('@/utils/request')

describe('Áî®Êà∑ API', () => {
  beforeEach(() => {
    vi.clearAllMocks()
  })
  
  describe('getUserInfo', () => {
    it('Â∫îËØ•Ê≠£Á°ÆËé∑ÂèñÁî®Êà∑‰ø°ÊÅØ', async () => {
      const mockResponse = {
        code: 200,
        data: {
          id: '1',
          name: 'Âº†‰∏â',
          email: 'zhangsan@example.com'
        }
      }
      
      vi.mocked(request.get).mockResolvedValue(mockResponse)
      
      const result = await getUserInfo('1')
      
      expect(request.get).toHaveBeenCalledWith('/api/user/1')
      expect(result).toEqual(mockResponse)
    })
    
    it('Â∫îËØ•Â§ÑÁêÜ API ÈîôËØØ', async () => {
      vi.mocked(request.get).mockRejectedValue(new Error('ÁΩëÁªúÈîôËØØ'))
      
      await expect(getUserInfo('1')).rejects.toThrow('ÁΩëÁªúÈîôËØØ')
    })
  })
  
  describe('updateUserInfo', () => {
    it('Â∫îËØ•Ê≠£Á°ÆÊõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØ', async () => {
      const updateData = {
        name: 'ÊùéÂõõ',
        email: 'lisi@example.com'
      }
      
      const mockResponse = {
        code: 200,
        data: {
          id: '1',
          ...updateData
        }
      }
      
      vi.mocked(request.put).mockResolvedValue(mockResponse)
      
      const result = await updateUserInfo('1', updateData)
      
      expect(request.put).toHaveBeenCalledWith('/api/user/1', updateData)
      expect(result).toEqual(mockResponse)
    })
  })
  
  describe('login', () => {
    it('Â∫îËØ•Ê≠£Á°ÆÂ§ÑÁêÜÁôªÂΩï', async () => {
      const credentials = {
        email: 'zhangsan@example.com',
        password: 'password123'
      }
      
      const mockResponse = {
        code: 200,
        data: {
          token: 'mock-jwt-token',
          userInfo: {
            id: '1',
            name: 'Âº†‰∏â',
            email: 'zhangsan@example.com'
          }
        }
      }
      
      vi.mocked(request.post).mockResolvedValue(mockResponse)
      
      const result = await login(credentials.email, credentials.password)
      
      expect(request.post).toHaveBeenCalledWith('/api/auth/login', credentials)
      expect(result).toEqual(mockResponse)
    })
  })
})
```

---

## üé≠ E2E ÊµãËØï

### 1. Playwright ÈÖçÁΩÆ

```typescript
// playwright.config.ts
import { defineConfig, devices } from '@playwright/test'

export default defineConfig({
  testDir: './tests/e2e',
  
  // Âπ∂Ë°åËøêË°åÊµãËØï
  fullyParallel: true,
  
  // Â§±Ë¥•Êó∂ÈáçËØïÊ¨°Êï∞
  retries: process.env.CI ? 2 : 0,
  
  // Âπ∂Ë°åÂ∑•‰ΩúËøõÁ®ãÊï∞
  workers: process.env.CI ? 1 : undefined,
  
  // Êä•ÂëäÈÖçÁΩÆ
  reporter: [
    ['html'],
    ['json', { outputFile: 'test-results/results.json' }]
  ],
  
  use: {
    // Âü∫Á°Ä URL
    baseURL: 'http://localhost:3000',
    
    // ÊµèËßàÂô®‰∏ä‰∏ãÊñáÈÖçÁΩÆ
    trace: 'on-first-retry',
    screenshot: 'only-on-failure',
    video: 'retain-on-failure'
  },
  
  // È°πÁõÆÈÖçÁΩÆ
  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] }
    },
    {
      name: 'firefox',
      use: { ...devices['Desktop Firefox'] }
    },
    {
      name: 'webkit',
      use: { ...devices['Desktop Safari'] }
    },
    {
      name: 'Mobile Chrome',
      use: { ...devices['Pixel 5'] }
    },
    {
      name: 'Mobile Safari',
      use: { ...devices['iPhone 12'] }
    }
  ],
  
  // ÂºÄÂèëÊúçÂä°Âô®ÈÖçÁΩÆ
  webServer: {
    command: 'npm run dev',
    url: 'http://localhost:3000',
    reuseExistingServer: !process.env.CI
  }
})
```

### 2. E2E ÊµãËØïÁî®‰æã

```typescript
// tests/e2e/user-flow.spec.ts
import { test, expect } from '@playwright/test'

test.describe('Áî®Êà∑ÊµÅÁ®ãÊµãËØï', () => {
  test.beforeEach(async ({ page }) => {
    // ÊØè‰∏™ÊµãËØïÂâçÁöÑÂáÜÂ§áÂ∑•‰Ωú
    await page.goto('/')
  })
  
  test('Áî®Êà∑Ê≥®ÂÜåÊµÅÁ®ã', async ({ page }) => {
    // ÂØºËà™Âà∞Ê≥®ÂÜåÈ°µÈù¢
    await page.click('[data-testid="register-link"]')
    await expect(page).toHaveURL('/register')
    
    // Â°´ÂÜôÊ≥®ÂÜåË°®Âçï
    await page.fill('[data-testid="name-input"]', 'ÊµãËØïÁî®Êà∑')
    await page.fill('[data-testid="email-input"]', 'test@example.com')
    await page.fill('[data-testid="password-input"]', 'password123')
    await page.fill('[data-testid="confirm-password-input"]', 'password123')
    
    // Êèê‰∫§Ë°®Âçï
    await page.click('[data-testid="register-button"]')
    
    // È™åËØÅÊ≥®ÂÜåÊàêÂäü
    await expect(page.locator('[data-testid="success-message"]')).toBeVisible()
    await expect(page).toHaveURL('/login')
  })
  
  test('Áî®Êà∑ÁôªÂΩïÊµÅÁ®ã', async ({ page }) => {
    // ÂØºËà™Âà∞ÁôªÂΩïÈ°µÈù¢
    await page.click('[data-testid="login-link"]')
    await expect(page).toHaveURL('/login')
    
    // Â°´ÂÜôÁôªÂΩïË°®Âçï
    await page.fill('[data-testid="email-input"]', 'test@example.com')
    await page.fill('[data-testid="password-input"]', 'password123')
    
    // Êèê‰∫§ÁôªÂΩï
    await page.click('[data-testid="login-button"]')
    
    // È™åËØÅÁôªÂΩïÊàêÂäü
    await expect(page).toHaveURL('/dashboard')
    await expect(page.locator('[data-testid="user-avatar"]')).toBeVisible()
  })
  
  test('Áî®Êà∑ËµÑÊñôÁºñËæëÊµÅÁ®ã', async ({ page }) => {
    // ÂÖàÁôªÂΩï
    await page.goto('/login')
    await page.fill('[data-testid="email-input"]', 'test@example.com')
    await page.fill('[data-testid="password-input"]', 'password123')
    await page.click('[data-testid="login-button"]')
    
    // ÂØºËà™Âà∞Áî®Êà∑ËµÑÊñôÈ°µÈù¢
    await page.click('[data-testid="user-avatar"]')
    await page.click('[data-testid="profile-link"]')
    await expect(page).toHaveURL('/user/profile')
    
    // ÁºñËæëÁî®Êà∑‰ø°ÊÅØ
    await page.click('[data-testid="edit-button"]')
    await page.fill('[data-testid="name-input"]', 'Êõ¥Êñ∞ÁöÑÁî®Êà∑Âêç')
    await page.fill('[data-testid="phone-input"]', '13800138000')
    
    // ‰øùÂ≠òÊõ¥Êîπ
    await page.click('[data-testid="save-button"]')
    
    // È™åËØÅÊõ¥Êñ∞ÊàêÂäü
    await expect(page.locator('[data-testid="success-toast"]')).toBeVisible()
    await expect(page.locator('[data-testid="user-name"]')).toHaveText('Êõ¥Êñ∞ÁöÑÁî®Êà∑Âêç')
  })
  
  test('ÂìçÂ∫îÂºèËÆæËÆ°ÊµãËØï', async ({ page }) => {
    // ÊµãËØïÊ°åÈù¢ËßÜÂõæ
    await page.setViewportSize({ width: 1200, height: 800 })
    await expect(page.locator('[data-testid="desktop-nav"]')).toBeVisible()
    await expect(page.locator('[data-testid="mobile-nav"]')).not.toBeVisible()
    
    // ÊµãËØïÁßªÂä®ËßÜÂõæ
    await page.setViewportSize({ width: 375, height: 667 })
    await expect(page.locator('[data-testid="mobile-nav"]')).toBeVisible()
    await expect(page.locator('[data-testid="desktop-nav"]')).not.toBeVisible()
    
    // ÊµãËØïÁßªÂä®ÂØºËà™
    await page.click('[data-testid="mobile-menu-button"]')
    await expect(page.locator('[data-testid="mobile-menu"]')).toBeVisible()
  })
})
```

### 3. È°µÈù¢ÂØπË±°Ê®°Âºè

```typescript
// tests/e2e/pages/LoginPage.ts
import { Page, Locator } from '@playwright/test'

export class LoginPage {
  readonly page: Page
  readonly emailInput: Locator
  readonly passwordInput: Locator
  readonly loginButton: Locator
  readonly errorMessage: Locator
  
  constructor(page: Page) {
    this.page = page
    this.emailInput = page.locator('[data-testid="email-input"]')
    this.passwordInput = page.locator('[data-testid="password-input"]')
    this.loginButton = page.locator('[data-testid="login-button"]')
    this.errorMessage = page.locator('[data-testid="error-message"]')
  }
  
  async goto() {
    await this.page.goto('/login')
  }
  
  async login(email: string, password: string) {
    await this.emailInput.fill(email)
    await this.passwordInput.fill(password)
    await this.loginButton.click()
  }
  
  async getErrorMessage() {
    return await this.errorMessage.textContent()
  }
}
```

---

## üìä ÊµãËØïÊä•ÂëäÂíåË¶ÜÁõñÁéá

### 1. ÁîüÊàêÊµãËØïÊä•Âëä

```json
// package.json scripts
{
  "scripts": {
    "test": "vitest",
    "test:ui": "vitest --ui",
    "test:run": "vitest run",
    "test:coverage": "vitest run --coverage",
    "test:e2e": "playwright test",
    "test:e2e:ui": "playwright test --ui",
    "test:report": "playwright show-report"
  }
}
```

### 2. CI/CD ÈõÜÊàê

```yaml
# .github/workflows/test.yml
name: ÊµãËØïÊµÅÊ∞¥Á∫ø

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: ËÆæÁΩÆ Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: ÂÆâË£Ö‰æùËµñ
      run: npm ci
    
    - name: ËøêË°åÂçïÂÖÉÊµãËØï
      run: npm run test:coverage
    
    - name: ‰∏ä‰º†Ë¶ÜÁõñÁéáÊä•Âëä
      uses: codecov/codecov-action@v3
      with:
        file: ./coverage/lcov.info
    
    - name: ËøêË°å E2E ÊµãËØï
      run: |
        npx playwright install --with-deps
        npm run test:e2e
    
    - name: ‰∏ä‰º†ÊµãËØïÊä•Âëä
      uses: actions/upload-artifact@v3
      if: always()
      with:
        name: playwright-report
        path: playwright-report/
        retention-days: 30
```

---

## üéØ ÊµãËØïÊúÄ‰Ω≥ÂÆûË∑µ

### 1. ÊµãËØïÂëΩÂêçËßÑËåÉ

```typescript
// ‚úÖ Â•ΩÁöÑÊµãËØïÂëΩÂêç
describe('UserService', () => {
  describe('getUserById', () => {
    it('Â∫îËØ•ËøîÂõûÁî®Êà∑‰ø°ÊÅØÂΩìÁî®Êà∑Â≠òÂú®Êó∂', () => {})
    it('Â∫îËØ•ÊäõÂá∫ÈîôËØØÂΩìÁî®Êà∑‰∏çÂ≠òÂú®Êó∂', () => {})
    it('Â∫îËØ•ÊäõÂá∫ÈîôËØØÂΩìIDÊó†ÊïàÊó∂', () => {})
  })
})

// ‚ùå ‰∏çÂ•ΩÁöÑÊµãËØïÂëΩÂêç
describe('UserService', () => {
  it('test1', () => {})
  it('getUserById works', () => {})
  it('error case', () => {})
})
```

### 2. ÊµãËØïÊï∞ÊçÆÁÆ°ÁêÜ

```typescript
// tests/fixtures/user.ts
export const userFixtures = {
  validUser: {
    id: '1',
    name: 'Âº†‰∏â',
    email: 'zhangsan@example.com',
    phone: '13800138000'
  },
  
  adminUser: {
    id: '2',
    name: 'ÁÆ°ÁêÜÂëò',
    email: 'admin@example.com',
    role: 'admin'
  },
  
  incompleteUser: {
    id: '3',
    name: 'ÊùéÂõõ'
    // Áº∫Â∞ë email
  }
}

export const createUser = (overrides = {}) => ({
  ...userFixtures.validUser,
  ...overrides
})
```

### 3. Mock Á≠ñÁï•

```typescript
// Ê®°ÂùóÁ∫ßÂà´ Mock
vi.mock('@/api/user', () => ({
  getUserInfo: vi.fn(),
  updateUserInfo: vi.fn()
}))

// Êù°‰ª∂ Mock
const mockGetUserInfo = vi.fn()
vi.mock('@/api/user', async () => {
  const actual = await vi.importActual('@/api/user')
  return {
    ...actual,
    getUserInfo: mockGetUserInfo
  }
})

// ÈÉ®ÂàÜ Mock
vi.mock('@/utils/request', () => ({
  request: {
    get: vi.fn(),
    post: vi.fn(),
    put: vi.fn(),
    delete: vi.fn()
  }
}))
```

### 4. ÂºÇÊ≠•ÊµãËØïÂ§ÑÁêÜ

```typescript
// ‚úÖ Ê≠£Á°ÆÁöÑÂºÇÊ≠•ÊµãËØï
it('Â∫îËØ•Ê≠£Á°ÆÂ§ÑÁêÜÂºÇÊ≠•Êìç‰Ωú', async () => {
  const promise = asyncFunction()
  await expect(promise).resolves.toBe('expected result')
})

// ‚úÖ ‰ΩøÁî® waitFor Á≠âÂæÖÊù°‰ª∂
it('Â∫îËØ•Á≠âÂæÖÂÖÉÁ¥†Âá∫Áé∞', async () => {
  render(<Component />)
  await waitFor(() => {
    expect(screen.getByText('Loading...')).toBeInTheDocument()
  })
})

// ‚ùå ÂøòËÆ∞Á≠âÂæÖÂºÇÊ≠•Êìç‰Ωú
it('ÈîôËØØÁöÑÂºÇÊ≠•ÊµãËØï', () => {
  asyncFunction() // Ê≤°Êúâ await
  expect(result).toBe('expected') // ÂèØËÉΩÂú®ÂºÇÊ≠•Êìç‰ΩúÂÆåÊàêÂâçÊâßË°å
})
```

---

## üîß ÊµãËØïÂ∑•ÂÖ∑ÂíåÊèí‰ª∂

### Êé®ËçêÂ∑•ÂÖ∑

- **Vitest**: Âø´ÈÄüÁöÑÂçïÂÖÉÊµãËØïÊ°ÜÊû∂
- **Vue Test Utils**: Vue ÁªÑ‰ª∂ÊµãËØïÂ∑•ÂÖ∑
- **Playwright**: Áé∞‰ª£ E2E ÊµãËØïÊ°ÜÊû∂
- **MSW**: API Mock ÊúçÂä°
- **Testing Library**: Áî®Êà∑Ë°å‰∏∫È©±Âä®ÁöÑÊµãËØïÂ∑•ÂÖ∑

### VSCode Êèí‰ª∂

- **Vitest**: Vitest ÊµãËØïËøêË°åÂô®
- **Playwright Test for VSCode**: Playwright ÈõÜÊàê
- **Jest Runner**: ÊµãËØïËøêË°åÂíåË∞ÉËØï
- **Coverage Gutters**: ‰ª£Á†ÅË¶ÜÁõñÁéáÊòæÁ§∫

---

*ÊúÄÂêéÊõ¥Êñ∞: 2024Âπ¥*
*Áª¥Êä§ËÄÖ: ÂºÄÂèëÂõ¢Èòü*