# 日历红点方案演进

## Stage 1：按年度聚合过滤
- **目标**：保证日历红点覆盖当年度所有有工单的日期。
- **实现**：
  - 使用 Directus Items API 聚合接口，以 `groupBy[]=date_created:day` 和 `aggregate[count]=id` 拉取当年每日工单数量。
  - 时间范围固定为 `当年 1 月 1 日 00:00` 至 `当年 12 月 31 日 23:59`（或当天），确保全年无遗漏。
  - 将聚合结果映射为红点日期集合供前端日历使用，替代原先依赖分页缓存的逻辑。
- **特点**：
  - 无需新增表结构；每次打开日历或执行关键操作时直接调用聚合接口。
  - 单次返回数据量小（最多 366 天），对 Directus 压力可控。

## Stage 2（可选）：缓存或统计表
- **适用场景**：数据量增长、聚合调用频率上升，或需要更多维度统计（按状态、社区等）。
- **思路**：
  - 新建 `work_order_daily_stats` 等统计表，通过 Directus Flow/自定义服务实时维护每日统计结果。
  - 日历查询改为读取统计表（可带缓存），前端不必每次聚合原始数据。
  - 可扩展字段（状态、分类、社区）以支撑更多筛选需求。

当前工作聚焦 Stage 1；Stage 2 作为后续性能/功能优化选项。
