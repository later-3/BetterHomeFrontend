# 需求文档 - 财务透明功能 v2.0

## 概述

为小区业主提供完整、透明的财务信息查询功能，涵盖物业费收缴、公共收益、各类支出、维修基金管理等，满足业主知情权和监督权。

**设计原则**：
- 应收与实收分离
- 完整的凭证支持
- 多角色权限（业主/物业/业委会）
- 可扩展的收入/支出类型

## 用户故事

### 业主视角（Resident）

#### US-R1: 查看我的物业费缴纳记录

**作为**业主，**我想**查看我家每月的物业费缴纳记录，**以便**了解自己的缴费历史，避免漏缴。

**验收标准**：
1. ✅ 可以看到所有账期的物业费账单（应缴金额、已缴金额、状态）
2. ✅ 可以看到每笔缴费记录（缴费时间、金额、支付方式）
3. ✅ 可以筛选账期（2024-01、2024-02...）
4. ✅ 可以看到欠费提醒（逾期、未缴）
5. ✅ 可以下载缴费凭证
6. ✅ 只能看到自己家的记录，不能看其他业主
7. ✅ 支持分页加载

**优先级**：P0（MVP必须）

---

#### US-R2: 查看小区财务总览

**作为**业主，**我想**看到今年截止当月的财务总览（总收入、总支出、结余），**以便**了解小区财务状况，监督物业。

**验收标准**：
1. ✅ 显示当年总收入（物业费收入 + 公共收益收入）
2. ✅ 显示当年总支出（分类汇总）
3. ✅ 显示结余（收入 - 支出）
4. ✅ 支持选择年份查看历史数据
5. ✅ 数据实时更新（或定期刷新）
6. ✅ 可视化展示（饼图、柱状图）
7. ✅ 数据准确性保证

**优先级**：P0（MVP必须）

---

#### US-R3: 查看收入明细

**作为**业主，**我想**点击"总收入"查看详细组成，**以便**了解小区收入来源。

**验收标准**：
1. ✅ 显示物业费收入汇总（不显示具体哪户缴纳，只显示总金额）
2. ✅ 显示各类公共收益（广告、停车、场地租赁、其他）
3. ✅ 每类收益可展开查看具体明细
4. ✅ 广告收益：显示广告位置、广告商、金额、时间
5. ✅ 停车收益：显示汇总金额（不显示具体车主隐私）
6. ✅ 场地租赁：显示场地、租赁方、金额、时间
7. ✅ 每笔收入有凭证（可查看合同、收款凭证）
8. ✅ 支持按月查看
9. ✅ 支持按收益类型筛选

**优先级**：P0（MVP必须）

---

#### US-R4: 查看支出明细

**作为**业主，**我想**点击"总支出"查看详细组成，**以便**监督物业支出合理性。

**验收标准**：
1. ✅ 显示各类支出汇总（工资、维护、能耗、耗材、活动、业委会经费、维修基金）
2. ✅ 每类支出可展开查看具体明细
3. ✅ **工资支出**：显示岗位分布（保安×4人、保洁×3人...）、总金额，但不显示具体姓名和工资
4. ✅ **设施维护**：显示维护项目、服务商、金额、时间、凭证
5. ✅ **公共能耗**：显示水电账单、用量、金额
6. ✅ **耗材采购**：显示采购清单、金额、凭证
7. ✅ **社区活动**：显示活动名称、用途、金额、凭证
8. ✅ **业委会经费**：显示用途、金额、凭证
9. ✅ 每笔支出有凭证（可查看发票、合同、转账记录）
10. ✅ 支持按月查看
11. ✅ 支持按支出类型筛选

**优先级**：P0（MVP必须）

---

#### US-R5: 查看每月详细账目

**作为**业主，**我想**选择某个月份，查看该月的所有收支明细，**以便**详细监督财务。

**验收标准**：
1. ✅ 可以选择月份（年月选择器）
2. ✅ 显示该月总收入、总支出、结余
3. ✅ 显示该月所有收入明细（列表）
4. ✅ 显示该月所有支出明细（列表）
5. ✅ 每笔收支都有：时间、类型、金额、凭证
6. ✅ 支持导出（PDF或Excel，V2.0功能）

**优先级**：P1（重要）

---

#### US-R6: 查看维修基金使用情况

**作为**业主，**我想**查看维修基金的使用情况，**以便**了解维修基金去向。

**验收标准**：
1. ✅ 显示我家的维修基金余额
2. ✅ 显示我家的历史缴纳记录（首次缴纳、续筹）
3. ✅ 显示小区维修基金历史使用记录（所有业主共享）
4. ✅ 每笔使用记录包括：项目名称、项目类型、金额、审批流程、施工记录、凭证
5. ✅ 可以看到审批流程：申请 → 业委会审批 → 使用 → 完成
6. ✅ 可以查看审批意见
7. ✅ 可以查看施工单位、合同、发票等凭证

**优先级**：P1（重要）

---

### 物业公司视角（Property Manager）

#### US-PM1: 录入物业费收款记录

**作为**物业，**我需要**录入业主的物业费缴纳记录，**以便**记录收款。

**验收标准**：
1. ✅ 可以选择业主（搜索或下拉）
2. ✅ 可以选择账期（自动显示该账期应缴金额）
3. ✅ 可以输入实收金额（支持部分缴费）
4. ✅ 可以选择支付方式（微信/支付宝/银行转账/现金/POS）
5. ✅ 可以输入缴费人信息（姓名、电话）
6. ✅ 可以输入交易流水号
7. ✅ 可以上传缴费凭证（截图、照片）
8. ✅ 保存后自动更新账单状态（未缴 → 部分缴纳 → 已缴）
9. ✅ 表单验证（必填项、金额格式）

**优先级**：P0（MVP必须）

---

#### US-PM2: 录入公共收益

**作为**物业，**我需要**录入各类公共收益，**以便**财务透明。

**验收标准**：
1. ✅ 可以选择收益类型（广告/停车/场地租赁/售货机/快递柜/废品回收/其他）
2. ✅ 可以输入收益标题
3. ✅ 可以输入详细说明
4. ✅ 可以输入收益金额
5. ✅ 可以选择收益日期
6. ✅ 可以选择支付方式
7. ✅ 可以输入交易流水号
8. ✅ 可以输入关联信息（JSON或表单字段）
   - 广告：广告商、广告位置、合同编号
   - 停车：车位号、租户、租赁类型
   - 场地：场地名称、租赁方、用途
9. ✅ 可以上传凭证（合同、收款凭证）
10. ✅ 保存后自动更新财务总览

**优先级**：P0（MVP必须）

---

#### US-PM3: 录入各类支出

**作为**物业，**我需要**录入各类支出，**以便**财务透明。

**验收标准**：
1. ✅ 可以选择支出类型（工资/维护/能耗/耗材/活动/业委会经费/维修基金/其他）
2. ✅ 可以输入支出标题
3. ✅ 可以输入详细说明
4. ✅ 可以输入支出金额
5. ✅ 可以选择支付日期
6. ✅ 可以选择支付方式
7. ✅ 可以选择分类（更细粒度，如"工资-保安"）
8. ✅ 可以输入关联信息（JSON或表单字段）
9. ✅ 可以上传凭证（发票、合同、转账记录）
10. ✅ 保存后自动更新财务总览

**优先级**：P0（MVP必须）

---

#### US-PM4: 管理员工信息

**作为**物业，**我需要**管理员工信息，**以便**员工管理和工资支出记录。

**验收标准**：
1. ✅ 可以添加员工（姓名、电话、身份证后4位、岗位、入职日期、基本工资）
2. ✅ 可以编辑员工信息
3. ✅ 可以标记员工离职（离职日期）
4. ✅ 可以查看在职员工列表
5. ✅ 可以查看离职员工列表
6. ✅ 可以按岗位筛选
7. ✅ 可以搜索员工（姓名、电话）

**优先级**：P0（MVP必须）

---

#### US-PM5: 录入工资发放记录

**作为**物业，**我需要**每月录入工资发放记录，**以便**工资支出透明。

**验收标准**：
1. ✅ 可以选择月份
2. ✅ 可以批量为所有在职员工生成工资记录（基于基本工资）
3. ✅ 可以编辑每个员工的工资明细（基本工资、奖金、补贴、扣款、社保、公积金）
4. ✅ 自动计算实发金额
5. ✅ 可以选择发放日期、发放方式
6. ✅ 可以上传凭证（工资表、转账记录）
7. ✅ 保存后自动创建支出记录（类型：工资）
8. ✅ 防止重复录入（同一员工同一月份只能录一次）

**优先级**：P0（MVP必须）

---

#### US-PM6: 查看欠费业主

**作为**物业，**我需要**看到哪些业主还未缴纳物业费，**以便**催缴。

**验收标准**：
1. ✅ 显示所有未缴/部分缴纳的账单
2. ✅ 显示欠费金额、账期
3. ✅ 可以按楼栋筛选
4. ✅ 可以按账期筛选
5. ✅ 可以导出欠费名单（Excel）
6. ✅ 可以一键发送催缴通知（短信/站内消息，V2.0功能）

**优先级**：P1（重要）

---

#### US-PM7: 生成财务报表

**作为**物业，**我需要**生成月度/年度财务报表，**以便**供业委会和业主查阅。

**验收标准**：
1. ✅ 可以选择报表类型（月度/年度）
2. ✅ 可以选择时间范围
3. ✅ 自动生成报表（总收入、总支出、结余、明细）
4. ✅ 支持导出PDF
5. ✅ 支持导出Excel
6. ✅ 报表包含统计图表

**优先级**：P2（V2.0功能）

---

### 业委会视角（Committee Member）

#### US-CM1: 查看所有财务信息

**作为**业委会成员，**我需要**查看比业主更详细的财务信息，**以便**监督物业。

**验收标准**：
1. ✅ 可以看到所有业主的物业费缴纳情况（汇总，不显示具体姓名，只显示楼栋单元）
2. ✅ 可以看到所有收入明细（包括更详细的信息）
3. ✅ 可以看到所有支出明细（包括更详细的信息）
4. ✅ 可以看到员工岗位分布、人数、工资发放记录（可能包含姓名，但不显示身份证）
5. ✅ 可以导出所有财务数据

**优先级**：P1（重要）

---

#### US-CM2: 审批维修基金使用

**作为**业委会成员，**我需要**审批维修基金使用申请，**以便**把关重大支出。

**验收标准**：
1. ✅ 可以看到待审批的维修基金申请（工单列表）
2. ✅ 可以查看申请详情（项目名称、类型、预算、施工单位、合同等）
3. ✅ 可以查看申请凭证（申请单、合同等）
4. ✅ 可以批准申请（填写审批意见）
5. ✅ 可以拒绝申请（填写拒绝原因）
6. ✅ 审批通过后，物业可以录入实际使用金额
7. ✅ 可以查看审批历史

**优先级**：P1（重要）

---

#### US-CM3: 查看员工详细信息

**作为**业委会成员，**我需要**查看员工的详细信息，**以便**监督人员开支。

**验收标准**：
1. ✅ 可以看到所有在职员工列表
2. ✅ 可以看到员工姓名、岗位、入职日期
3. ✅ 可以看到每月工资发放记录（可能包含姓名和金额）
4. ✅ 可以看到岗位分布统计
5. ✅ 可以看到人员变动历史（离职、入职）

**优先级**：P2（V2.0功能）

---

#### US-CM4: 导出财务数据

**作为**业委会成员，**我需要**导出财务数据，**以便**业主大会公示。

**验收标准**：
1. ✅ 可以导出所有财务数据（Excel）
2. ✅ 可以选择导出范围（时间、类型）
3. ✅ 导出数据包含所有必要信息
4. ✅ 导出数据格式规范，便于打印和传播

**优先级**：P2（V2.0功能）

---

## 非功能性需求

### 性能要求
1. ✅ 列表页加载时间 < 2秒
2. ✅ 财务总览加载时间 < 1秒
3. ✅ 支持分页加载，每页20条
4. ✅ 支持上拉加载更多

### 安全要求
1. ✅ 所有操作需要登录鉴权
2. ✅ 不同角色有不同权限（业主/物业/业委会）
3. ✅ 业主只能看自己的账单，不能看其他业主
4. ✅ 敏感信息脱敏（身份证、具体业主信息）
5. ✅ 防止数据篡改（审计日志）

### 易用性要求
1. ✅ 界面清晰，信息层次分明
2. ✅ 操作简单，符合用户习惯
3. ✅ 表单验证友好，错误提示明确
4. ✅ 支持搜索、筛选、排序
5. ✅ 移动端适配

### 可维护性要求
1. ✅ 代码结构清晰，遵循项目规范
2. ✅ 完整的类型定义（TypeScript）
3. ✅ 完整的错误处理
4. ✅ 完整的注释和文档

---

## MVP 范围界定

### 包含（V1.0 - MVP）
- ✅ 业主查看物业费缴纳记录
- ✅ 业主查看财务总览（收入、支出、结余）
- ✅ 业主查看收入明细（物业费 + 公共收益）
- ✅ 业主查看支出明细（各类支出）
- ✅ 业主查看维修基金情况
- ✅ 物业录入收款记录
- ✅ 物业录入公共收益
- ✅ 物业录入各类支出
- ✅ 物业管理员工信息
- ✅ 物业录入工资发放记录
- ✅ 物业查看欠费业主
- ✅ 业委会审批维修基金
- ✅ 基于角色的权限控制

### 不包含（V2.0 后续迭代）
- ❌ 多账期批量缴费
- ❌ 在线支付集成
- ❌ 催缴通知（短信/站内消息）
- ❌ 财务报表生成（PDF）
- ❌ 数据可视化（高级图表）
- ❌ 数据导出（Excel）
- ❌ 维修基金业主大会表决（电子投票）
- ❌ 审计日志查询

---

## 依赖项

### 前置条件
1. ✅ 用户系统已完成（登录、权限）
2. ✅ 工单系统已完成（维修基金审批复用）
3. ✅ 文件上传系统已完成（Directus Files）

### 外部依赖
1. ✅ Directus 后端（版本 >= 10.x）
2. ✅ 数据库（PostgreSQL 或 MySQL）
3. ✅ 文件存储（Directus Files 或 OSS）
