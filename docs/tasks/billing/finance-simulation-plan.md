# 兰亭雅苑财务数据模拟方案

## 背景信息

- **社区名称**: 兰亭雅苑
- **社区ID**: `2a5c769e-9909-4331-99b3-983c8b1175c6`
- **现状**: 已有不少业主数据
- **目标**: 模拟完整的财务明细功能，用于测试和演示

## 方案分析

### 1. 数据模拟的目标

#### 1.1 业主端功能验证
- ✅ 查看自己的物业费账单（应收）
- ✅ 查看自己的缴费记录（实收）
- ✅ 查看小区收支情况（总览）
- ✅ 查看公共收益明细
- ✅ 查看支出明细（已审核）
- ✅ 查看维修基金账户和使用情况

#### 1.2 物业端功能验证
- ✅ 录入物业费收款
- ✅ 录入公共收益
- ✅ 录入支出
- ✅ 管理员工信息
- ✅ 发放工资
- ✅ 查看欠费业主

#### 1.3 业委会端功能验证
- ✅ 查看详细财务数据
- ✅ 审批维修基金使用申请
- ✅ 查看员工信息

### 2. 数据模拟策略

#### 2.1 时间跨度
**建议**: 模拟 2024年1月 - 2024年12月（12个月）的数据

**原因**:
- 可以展示完整的年度财务周期
- 可以测试月度汇总功能
- 可以展示趋势变化
- 数据量适中，不会太多也不会太少

#### 2.2 数据真实性原则
- **合理性**: 金额、比例符合实际情况
- **一致性**: 收入和支出要平衡，不能差距太大
- **完整性**: 每个月都有数据，不能有空白月份
- **多样性**: 包含各种类型的收入和支出

#### 2.3 数据量估算

假设兰亭雅苑有 **50户业主**：

| 数据类型 | 每月数量 | 12个月总量 | 说明 |
|---------|---------|-----------|------|
| 物业费账单 | 50条 | 600条 | 每户每月一条 |
| 物业费收款 | 40-45条 | ~500条 | 80-90%缴费率 |
| 公共收益 | 5-10条 | ~80条 | 广告、停车、场地等 |
| 支出记录 | 10-15条 | ~150条 | 工资、维修、能耗等 |
| 员工信息 | 8-10人 | 10条 | 保安、保洁、管理等 |
| 工资记录 | 8-10条 | ~100条 | 每人每月一条 |
| 维修基金账户 | 50个 | 50条 | 每户一个账户 |
| 维修基金缴纳 | 50条 | 50条 | 首次缴纳 |
| 维修基金使用 | 2-3条 | 3条 | 大型维修项目 |

**总计**: 约 **1,500+ 条记录**

### 3. 详细数据设计

#### 3.1 物业费账单（Billings）

**设计原则**:
- 每户每月一条账单
- 面积范围: 60-150㎡
- 单价: 2.5元/㎡
- 应缴金额 = 面积 × 单价
- 80-90% 的账单状态为 paid（已缴）
- 10-20% 的账单状态为 unpaid 或 partial（未缴或部分缴纳）
- 少数账单有滞纳金（逾期超过30天）

**示例数据**:
```json
{
  "community_id": "2a5c769e-9909-4331-99b3-983c8b1175c6",
  "building_id": "<楼栋ID>",
  "owner_id": "<业主ID>",
  "period": "2024-01",
  "billing_amount": 250.00,
  "area": 100.00,
  "unit_price": 2.50,
  "status": "paid",
  "paid_amount": 250.00,
  "due_date": "2024-01-31T23:59:59",
  "late_fee": 0
}
```

#### 3.2 物业费收款（Billing Payments）

**设计原则**:
- 对应已缴纳的账单
- 80% 在当月缴纳，20% 延迟1-2个月
- 支付方式分布: 微信40%、支付宝30%、银行转账25%、现金5%
- 少数支持部分缴费（分2-3次缴清）

**示例数据**:
```json
{
  "billing_id": "<账单ID>",
  "community_id": "2a5c769e-9909-4331-99b3-983c8b1175c6",
  "owner_id": "<业主ID>",
  "amount": 250.00,
  "paid_at": "2024-01-15T10:30:00",
  "payment_method": "wechat",
  "payer_name": "张三",
  "payer_phone": "13800138000",
  "transaction_no": "WX20240115103000123456"
}
```

#### 3.3 公共收益（Incomes）

**设计原则**:
- 每月5-10条记录
- 类型分布:
  - 广告收益: 30%（电梯广告、门禁广告）
  - 停车收益: 40%（临时停车、月租车位）
  - 场地租赁: 15%（会议室、活动场地）
  - 快递柜: 10%（快递柜分成）
  - 其他: 5%

**月度收益估算**:
- 广告收益: 3,000-5,000元/月
- 停车收益: 8,000-12,000元/月
- 场地租赁: 2,000-4,000元/月
- 快递柜: 1,000-2,000元/月
- **总计**: 14,000-23,000元/月

**示例数据**:
```json
{
  "community_id": "2a5c769e-9909-4331-99b3-983c8b1175c6",
  "income_type": "advertising",
  "title": "东门电梯广告位租赁",
  "description": "XX品牌电梯广告，1个月",
  "amount": 3000.00,
  "income_date": "2024-01-05T00:00:00",
  "period": "2024-01",
  "payment_method": "bank",
  "transaction_no": "BANK20240105001",
  "related_info": {
    "advertiser": "XX品牌",
    "location": "东门电梯",
    "contract_no": "AD202401001"
  }
}
```

#### 3.4 支出记录（Expenses）

**设计原则**:
- 每月10-15条记录
- 类型分布:
  - 员工工资: 50%（最大支出项）
  - 公共能耗: 20%（水电费）
  - 设施维护: 15%（日常维修）
  - 耗材采购: 10%（清洁用品等）
  - 其他: 5%

**月度支出估算**:
- 员工工资: 40,000-50,000元/月（8-10人）
- 公共能耗: 15,000-20,000元/月
- 设施维护: 10,000-15,000元/月
- 耗材采购: 5,000-8,000元/月
- 其他: 3,000-5,000元/月
- **总计**: 73,000-98,000元/月

**收支平衡分析**:
- 物业费收入: 50户 × 平均100㎡ × 2.5元 = 12,500元/月
- 公共收益: 14,000-23,000元/月
- **总收入**: 26,500-35,500元/月
- **总支出**: 73,000-98,000元/月
- **结余**: -46,500 ~ -62,500元/月（亏损）

⚠️ **问题**: 收支严重不平衡！

**调整方案**:
1. 提高物业费单价: 2.5元/㎡ → 4.0元/㎡
   - 新收入: 50户 × 100㎡ × 4.0元 = 20,000元/月
2. 减少员工数量: 10人 → 6人
   - 新工资支出: 30,000元/月
3. 调整后:
   - 总收入: 34,000-43,000元/月
   - 总支出: 58,000-73,000元/月
   - 结余: -15,000 ~ -30,000元/月（仍亏损，但更合理）

**示例数据**:
```json
{
  "community_id": "2a5c769e-9909-4331-99b3-983c8b1175c6",
  "expense_type": "utilities",
  "title": "2024年1月电费",
  "description": "小区公共区域电费",
  "amount": 8000.00,
  "paid_at": "2024-01-25T00:00:00",
  "period": "2024-01",
  "payment_method": "bank",
  "status": "approved",
  "created_by": "<物业经理ID>"
}
```

#### 3.5 员工信息（Employees）

**设计原则**:
- 总人数: 6-8人
- 岗位分布:
  - 保安: 3人（队长1人 + 队员2人）
  - 保洁: 2人
  - 管理: 1人（物业经理）
  - 水电工: 1人
- 工资范围:
  - 保安队长: 5,500元/月
  - 保安队员: 4,500元/月
  - 保洁: 4,000元/月
  - 物业经理: 7,000元/月
  - 水电工: 5,000元/月

**示例数据**:
```json
{
  "community_id": "2a5c769e-9909-4331-99b3-983c8b1175c6",
  "name": "张三",
  "phone": "13800138001",
  "id_card_last4": "1234",
  "position_type": "security",
  "position_title": "保安队长",
  "employment_status": "active",
  "hire_date": "2023-06-01",
  "base_salary": 5500.00
}
```

#### 3.6 工资记录（Salary Records）

**设计原则**:
- 每人每月一条记录
- 包含: 基本工资、奖金、补贴、扣款、社保、公积金
- 实发金额 = 基本工资 + 奖金 + 补贴 - 扣款 - 社保 - 公积金
- 每月15日发放
- 自动关联到 expenses 表（expense_type = salary）

**示例数据**:
```json
{
  "employee_id": "<员工ID>",
  "community_id": "2a5c769e-9909-4331-99b3-983c8b1175c6",
  "period": "2024-01",
  "base_salary": 5500.00,
  "bonus": 500.00,
  "subsidy": 200.00,
  "deduction": 0,
  "social_security": 550.00,
  "housing_fund": 440.00,
  "actual_amount": 5210.00,
  "payment_date": "2024-01-15T00:00:00",
  "payment_method": "bank"
}
```

#### 3.7 维修基金账户（Maintenance Fund Accounts）

**设计原则**:
- 每户一个账户
- 首次缴纳标准: 100元/㎡
- 初始余额 = 房屋面积 × 100元
- 例如: 100㎡的房子，初始余额 = 10,000元

**示例数据**:
```json
{
  "community_id": "2a5c769e-9909-4331-99b3-983c8b1175c6",
  "building_id": "<楼栋ID>",
  "owner_id": "<业主ID>",
  "house_area": 100.00,
  "unit_number": "1-101",
  "total_paid": 10000.00,
  "total_used": 0,
  "balance": 10000.00,
  "last_payment_date": "2024-01-10T00:00:00"
}
```

#### 3.8 维修基金缴纳记录（Maintenance Fund Payments）

**设计原则**:
- 每户一条首次缴纳记录
- 缴纳时间: 2024年1月（集中缴纳）
- 缴纳金额 = 房屋面积 × 100元

**示例数据**:
```json
{
  "account_id": "<账户ID>",
  "community_id": "2a5c769e-9909-4331-99b3-983c8b1175c6",
  "owner_id": "<业主ID>",
  "payment_type": "initial",
  "amount": 10000.00,
  "paid_at": "2024-01-10T00:00:00",
  "payment_method": "bank",
  "house_area": 100.00,
  "unit_price": 100.00
}
```

#### 3.9 维修基金使用记录（Maintenance Fund Usage）

**设计原则**:
- 全年2-3个大型维修项目
- 项目类型: 电梯维修、外墙维修、屋顶防水等
- 每个项目需要业委会审批
- 审批通过后才能使用

**项目示例**:

**项目1: 电梯维修（2024年3月）**
```json
{
  "work_order_id": "<工单ID>",
  "community_id": "2a5c769e-9909-4331-99b3-983c8b1175c6",
  "project_name": "1号楼电梯大修",
  "project_type": "elevator",
  "description": "1号楼电梯使用10年，需要更换主要部件",
  "contractor": "XX电梯维修公司",
  "contract_no": "MF202403001",
  "estimated_amount": 80000.00,
  "actual_amount": 75000.00,
  "approval_status": "completed",
  "approved_by": "<业委会成员ID>",
  "approved_at": "2024-03-05T00:00:00",
  "usage_date": "2024-03-20T00:00:00",
  "expense_id": "<支出记录ID>"
}
```

**项目2: 外墙维修（2024年6月）**
```json
{
  "project_name": "外墙防水维修",
  "project_type": "exterior_wall",
  "estimated_amount": 120000.00,
  "actual_amount": 115000.00,
  "approval_status": "completed"
}
```

**项目3: 屋顶防水（2024年9月）**
```json
{
  "project_name": "屋顶防水翻新",
  "project_type": "roof",
  "estimated_amount": 60000.00,
  "actual_amount": 58000.00,
  "approval_status": "completed"
}
```

### 4. 数据生成方案

#### 4.1 手动创建（适合小规模测试）

**优点**:
- 数据质量高
- 可以精确控制
- 便于理解和调试

**缺点**:
- 耗时长
- 容易出错
- 不适合大量数据

**适用场景**: 创建 10-20 条核心数据用于功能验证

#### 4.2 脚本批量生成（推荐）

**优点**:
- 快速生成大量数据
- 数据一致性好
- 可重复执行
- 便于调整参数

**缺点**:
- 需要编写脚本
- 需要了解 Directus API

**适用场景**: 生成完整的 12 个月数据

**实现方式**:
1. 使用 Node.js + Directus SDK
2. 或使用 Python + requests
3. 或使用 bash + curl

#### 4.3 CSV 导入（折中方案）

**优点**:
- 可以用 Excel 编辑
- 直观易懂
- Directus 支持 CSV 导入

**缺点**:
- 需要手动处理关系
- UUID 需要提前生成
- 不适合复杂关联

**适用场景**: 员工信息、公共收益等独立数据

### 5. 推荐实施方案

#### 方案A: 最小可行方案（MVP）

**目标**: 快速验证核心功能

**数据范围**:
- 时间: 2024年1月 - 2024年3月（3个月）
- 业主: 10户（从现有业主中选择）
- 员工: 4人（保安2人、保洁1人、经理1人）

**数据量**:
- 物业费账单: 30条
- 物业费收款: 25条
- 公共收益: 15条
- 支出记录: 30条
- 员工信息: 4条
- 工资记录: 12条
- 维修基金账户: 10个
- 维修基金缴纳: 10条
- 维修基金使用: 1条

**总计**: 约 137 条记录

**实施方式**: 手动创建 + 部分脚本

**时间估算**: 2-3 小时

#### 方案B: 完整演示方案（推荐）

**目标**: 完整展示所有功能

**数据范围**:
- 时间: 2024年1月 - 2024年12月（12个月）
- 业主: 30户（从现有业主中选择）
- 员工: 6人

**数据量**:
- 物业费账单: 360条
- 物业费收款: 300条
- 公共收益: 80条
- 支出记录: 150条
- 员工信息: 6条
- 工资记录: 72条
- 维修基金账户: 30个
- 维修基金缴纳: 30条
- 维修基金使用: 3条

**总计**: 约 1,031 条记录

**实施方式**: 脚本批量生成

**时间估算**: 4-6 小时（含脚本开发）

#### 方案C: 真实模拟方案（最完整）

**目标**: 接近真实运营数据

**数据范围**:
- 时间: 2024年1月 - 2024年12月（12个月）
- 业主: 全部现有业主（假设50户）
- 员工: 8人

**数据量**: 约 1,500+ 条记录

**实施方式**: 脚本批量生成 + 手动调整

**时间估算**: 6-8 小时

### 6. 数据生成顺序

**重要**: 必须按照依赖关系顺序创建数据

```
1. 员工信息（Employees）
   ↓
2. 物业费账单（Billings）
   ↓
3. 物业费收款（Billing Payments）
   ↓ （更新账单的 paid_amount 和 status）
4. 公共收益（Incomes）
   ↓
5. 工资记录（Salary Records）
   ↓
6. 支出记录（Expenses）
   ↓ （关联工资记录）
7. 维修基金账户（Maintenance Fund Accounts）
   ↓
8. 维修基金缴纳（Maintenance Fund Payments）
   ↓ （更新账户的 total_paid 和 balance）
9. 工单（Work Orders）- 类型: maintenance_fund_application
   ↓
10. 维修基金使用（Maintenance Fund Usage）
    ↓ （关联工单和支出记录）
11. 更新账户余额（total_used, balance）
```

### 7. 数据验证清单

生成数据后，需要验证：

#### 7.1 数据完整性
- [ ] 每个月都有数据
- [ ] 每户业主都有账单
- [ ] 所有关系字段都正确关联
- [ ] 没有孤立的记录

#### 7.2 数据一致性
- [ ] 账单的 paid_amount = 对应收款记录的 amount 总和
- [ ] 账户的 balance = total_paid - total_used
- [ ] 工资记录的 expense_id 正确关联
- [ ] 维修基金使用的 expense_id 正确关联

#### 7.3 数据合理性
- [ ] 金额范围合理（不会出现负数或天文数字）
- [ ] 日期顺序正确（缴费日期 >= 账单日期）
- [ ] 状态转换合理（审批流程）
- [ ] 收支比例合理

#### 7.4 功能验证
- [ ] 业主可以查看自己的账单
- [ ] 财务总览数据正确
- [ ] 月度汇总正确
- [ ] 权限过滤正常工作

### 8. 风险和注意事项

#### 8.1 性能风险
- 大量数据可能影响查询性能
- 建议分批创建，每批 100-200 条
- 创建后检查数据库索引

#### 8.2 数据质量风险
- UUID 必须唯一
- 关系字段必须存在
- 枚举值必须匹配
- 日期格式必须正确

#### 8.3 权限风险
- 使用管理员 token 创建数据
- 创建后验证各角色的访问权限
- 确保业主只能看到自己的数据

### 9. 下一步行动

#### 选择方案
根据需求选择：
- **快速验证**: 方案A（MVP）
- **完整演示**: 方案B（推荐）
- **真实模拟**: 方案C

#### 准备工作
1. 获取兰亭雅苑的业主列表
2. 确定要使用的业主数量
3. 准备管理员 token
4. 选择数据生成方式（手动/脚本）

#### 实施步骤
1. 创建员工信息（4-8人）
2. 创建物业费账单（按月）
3. 创建收款记录
4. 创建公共收益
5. 创建支出记录
6. 创建维修基金相关数据
7. 验证数据
8. 测试功能

## 总结

**推荐方案**: 方案B（完整演示方案）

**理由**:
- 数据量适中（约1,000条）
- 覆盖完整年度周期
- 可以展示所有功能
- 实施时间可控（4-6小时）
- 适合演示和测试

**下一步**: 
1. 确认方案
2. 我可以帮你编写数据生成脚本
3. 或者提供详细的手动创建指南
