太好，我们进入 **Step 0：目标与边界对齐**。你先定规则，我给出**推荐默认值**（方括号内），你只需改动有异议的点即可。

# Step 0 · 行为规则清单（待拍板）

1. 评论层级

   * 支持：一级 → 二级 → 对二级的回复（称“三级”）
   * 展示：一级正常；二级**缩进**；对二级的回复（“三级”）**不再缩进**，以“@某某 …”内联展示。
   * \[默认：如上执行；最大深度 3]

2. 媒体约束（单条评论内）

   * 文本可选；图片/视频/音频**最多各 1 条**（即最多携带 1 种媒体）。
   * 图片支持预览原图；视频/音频仅**点击后**播放（不自动）。
   * \[默认：最大文本长度 2,000 字；图片 ≤ 10MB；视频 ≤ 100MB/60s；音频 ≤ 20MB/10min]

3. 默认可见性 & 折叠

   * 评论容器默认只展示**一级**评论列表。
   * 若某条一级有二级评论：\*\*点击“展开 N 条回复”\*\*后再展示该条的二级与其三级。
   * \[默认：二级首次仅展示前 3 条，更多再点一次展开]

4. 排序规则

   * 一级评论排序： \[默认：**按时间倒序**（最新在上），后续可加“最热”]
   * 二级/三级排序： \[默认：**按时间正序**（从早到晚，便于阅读上下文）]

5. 点赞 & Pass（你已定义=“点赞的反义词”）

   * 行为：**互斥**（同一用户对同一评论只能选其一）；可撤销；可从 like 切到 pass（或反之）。
   * 计数：公开显示 `like_count` 与 `pass_count`。
   * \[默认：点击切换即时“乐观更新”，失败回滚；冷却 1s/人/条以防抖]

6. 权限 & 审核

   * 谁能发：登录业主与物业/业委会成员。
   * 删除：作者可删自己的评论；管理员可删或屏蔽任何评论。
   * 审核：公共公告区可选开启“先审后发”。
   * \[默认：开启关键词过滤；命中则拦截或标记为待审]

7. 反滥用（治理基线）

   * 频率限制： \[默认：每人每分钟≤5条，带媒体≤2条]
   * 拉黑：被拉黑者对你的评论不可见、不可互动。
   * 举报：进入后台工单流。
   * \[默认：对违规内容展示“已被隐藏（点击申诉）”墓碑态]

8. 编辑与撤回

   * \[默认：不支持编辑；支持**撤回/删除**（作者 10 分钟内可撤回），撤回展示墓碑态]

9. 分页策略

   * 一级评论：**分页**（每页 20 条）；滚动触底加载下一页。
   * 子评：**点击展开时再拉取**（每次 10 条，可继续“更多回复”）。
   * \[默认：缓存已展开的子评，返回上层时不重拉]

10. 通知与@

* 支持 `@user`；被 @ 或被回复**可选**推送通知（后续迭代）。
* \[默认：MVP 只做“站内红点”，不做系统推送]

11. 时间显示

* \[默认：相对时间（刚刚/5分钟前…）+ 详情页悬浮绝对时间，时区按用户本地]

12. 删除展示

* \[默认：被删评论显示“已删除”，不再展示媒体；保留楼中楼结构完整性]

---

请你逐条确认/修改以上默认值（直接写“1) ✓ 2) 改成 … 3) ✓ …”即可）。
你确认后，我进入 **Step 1：关键用户流 & 交互原则**，把浏览/展开/发布/回复/点赞/Pass/删除/失败回滚等交互规约敲定。


好的 ✅

我来为您总结 **Step0 的讨论结果**，包括分页策略。我们已经形成了一套比较清晰的分页与展示规则，可以用一句话概括为：

**“顶层 20 / 子评 10 / 首次 3 / 阈值 20%”**

---

## Step0 最终讨论结果总结

### 1. 顶层评论 (一级评论)

* **默认获取**：一次请求获取 **20 条**。
* **默认展示**：页面初始只展示 20 条；继续下拉时再分页加载。
* **阈值**：当用户滑到底部并且当前评论数达到 **总数的 20%** 时，触发下一页请求。

### 2. 子评论 (二级评论)

* **默认获取**：一次请求获取 **10 条**。
* **默认展示**：初始只展示 10 条；如有更多，显示“展开更多回复”按钮。

### 3. 三级评论 (对二级的回复)

* **不额外缩进**，显示为“回复 @xxx”。
* 跟随所属的二级评论一起展示，不独立分页。

### 4. 首次加载策略

* **首页场景**：首次进入评论区时，先展示每条评论下的 **最多 3 条子评论**，作为预览。
* 用户点击“展开更多”后，再加载完整的二级评论分页数据。

### 5. 分页策略落地

* **前端容器 (CommentContainer.vue)**：

  * 负责管理分页状态（页码、是否还有更多、loading 状态）。
  * 滑动到底部 → 自动触发 `loadMoreTopLevelComments()`。
* **评论项 (CommentItem.vue)**：

  * 内部再管理子评论分页逻辑。
  * 初始只展示 3 条 → 点击展开后调用 API 获取完整分页（10 条/页）。

---

这样设计的好处是：

* **性能**：避免一次性加载过多评论，特别是评论区可能有几十条甚至上百条。
* **体验**：用户可以快速看到内容，不会因为评论太多而卡顿。
* **对齐业界**：和 Instagram、微博等主流平台的分页策略类似，先展示部分，再展开。

---

要不要我帮您把这个 Step0 的结果写入我们现有的《8.开发详细约束.md》文档中，形成正式的 **评论功能分页规范**？
