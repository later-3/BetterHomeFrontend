好，我们进入 **Step 1：关键用户流 & 交互原则**。这一阶段的目标是：把评论相关的**用户操作流程**和**交互体验规则**敲定清楚，保证前端组件和后端接口设计时有一套统一的行为规范。

我先列出要覆盖的用户流清单（业界如 Instagram、抖音、知乎等都有类似设计），我们一条一条过：

---

## Step 1 讨论清单

### A. 浏览流程

1. 进入详情页 → 自动拉取一级评论列表（分页，Step0 已定 20 条/页）。
2. 一级评论展示文本 + 媒体（图/视/音各最多 1）。
3. 若有子评论：展示前 3 条 + “展开更多回复”按钮。
4. 用户点击展开 → 拉取子评论（10 条/页），并缓存。
5. 滑动到底部 → 自动拉取下一页一级评论。

### B. 发布流程

1. 用户点击“写评论”或“回复 @xxx”。
2. 输入框支持：文字 + 1 个附件（图/视/音）。
3. 提交后：

   * 前端**乐观更新**（先插入一条“发送中”的评论项）。
   * 后端返回成功 → 替换为正式评论；失败 → 提示并移除/保持重试状态。
4. 评论发布后：评论计数 +1，立即可见。

### C. 回复流程

1. 一级评论下点击“回复” → 进入子评论编辑状态。
2. 二级评论下点击“回复” → 自动补全“@某某”，作为三级评论。
3. 三级评论显示为“回复 @某某 …”，不再缩进。

### D. 点赞 / Pass

1. 用户点击“赞” → like\_count +1（乐观更新）。
2. 用户再次点击 → 撤销点赞。
3. 用户点击“Pass” → 互斥逻辑：取消赞 + pass\_count +1。
4. 所有操作失败需回滚，并 toast 提示。

### E. 删除 / 撤回

1. 作者可删除自己的评论（10 分钟内可“撤回”直接消失；超过 10 分钟显示“已删除”墓碑）。
2. 管理员可随时删除/屏蔽评论 → 前端展示“已删除”。

### F. 媒体播放

1. 图片：点击 → `uni.previewImage` 全屏预览，可缩放。
2. 视频：只显示封面，点击才创建 `<video>`/进入播放页；离开视口暂停。
3. 音频：用自定义播放器（已设计），点击播放；全局互斥，页面切走暂停。

### G. 折叠 / 展开

1. 二级评论超过 3 条 → 默认折叠，仅展示 3 条。
2. 用户点击“展开更多” → 拉取并展示更多子评论。
3. 点击“收起” → 折叠到 3 条。

### H. 状态反馈

* **加载中**：骨架屏或 loading 动画。
* **失败**：toast + “重试”按钮。
* **空态**：无评论时显示“还没有评论”。

---

👉 建议：我们逐条确认这些用户流。
第一步先聚焦 **A. 浏览流程** 和 **B. 发布流程** ——这是最基础的两个流。

要不要我先展开 **A. 浏览流程** 的详细交互图（从进入详情页到展开子评论），然后我们确认是否符合你的预期？


太清楚了！基于你刚定的交互（底部固定输入=发**一级**评论；点**一级/二级**进入回复态；回复二级时自动带“@xxx”；“like/unlike”两种互斥反应），我把**还需要拍板的细节**做成一个简短确认清单，并给出推荐默认值（方括号）。你只要改有异议的点即可。

# 需要确认的细节（发布 & 回复流）

## 1) 输入框与回复态

* 进入回复态的触发：点一级/二级整块就进入？还是点“回复”按钮？【点整块进入，长按弹菜单（复制/举报/删）】
* 回复态文案：输入框 placeholder 显示什么？【“回复 @昵称” / “写评论…”】
* 退出回复态：如何清空并恢复到底部固定输入？【点“取消”或失焦收起键盘即退出】
* 是否保留草稿：切页或失焦后是否保留未发内容/附件？【保留 10 分钟，仅在当前详情页有效】

## 2) 媒体选择与限制（单条最多 1 种媒体）

* 可选媒体来源：相册/拍照/录音/视频拍摄？【图片(相册/拍照)、视频(相册/拍摄)、音频(录音)】
* 体积与时长限制（前端校验）：【图≤10MB；视≤100MB/60s；音≤20MB/10min】
* 压缩策略：是否在前端压缩图片/截取视频首帧 poster？【图片自动压缩上传；视频首帧由后端生成/或前端抽帧】
* 上传流程：先上传拿URL再发评论？失败如何提示？【先传附件→成功后发评论；失败给“重试上传/移除附件”】

## 3) 发送与乐观更新

* 发送后插入位置：一级评论发出后插入列表何处？【按“最新在上”，插入顶部】
* 子评论插入：展开状态下，发出的子评插入何处？【尾部（正序），滚动定位至新评论】
* 乐观状态样式：是否显示“发送中/失败重试”的灰态卡？【显示；点“重试”仅重发该条】

## 4) 分页与计数联动

* 新增评论是否立刻更新计数（一级的 replies\_count、页面总数）？【是，先+1，失败回滚】
* 若当前页满/末页：新增评论是否“越界”到上一页/下一页？【本地追加，不强制重拉全页】
* 回复在“未展开”时：用户发了子评，要自动展开该父评论吗？【是，自动展开并滚动定位】

## 5) like / unlike（互斥反应）

* 计数与互斥：同一用户同一评论仅二选一，二次点击为撤销？【是；like\_count / unlike\_count 分开计数】
* 冷却与防抖：是否设置最小间隔？【1s 防抖；失败回滚】
* UI 命名与图标：文案固定用“赞 / 踩（unlike）”还是“Like / Unlike”？【中文端：赞/踩；英文端：Like/Unlike】

## 6) 权限与约束

* 谁能评论：未登录是否允许进入输入框？【未登录点击输入先引导登录】
* 删除/撤回：作者可撤回窗口多久？撤回后展示什么？【10 分钟内可撤回；撤回后不留墓碑；超时删除显示墓碑】
* 屏蔽词与频率：是否前端预校验？【前端弱提示，后端强校验；频控：每人/分钟≤5条，带媒体≤2条】

## 7) 导航与滚动体验

* 发送后滚动：成功后是否自动滚至新评论并高亮 2 秒？【是】
* 打开键盘遮挡：输入框被键盘顶起时，是否自动确保输入框可见？【是】
* 长列表跳转：从通知或外链进入特定评论时，是否支持锚点定位并自动展开父级？【支持】

## 8) 提示与错误态

* 失败提示：网络/权限/风控命中分别展示何文案？【“网络异常，请重试”/“暂无权限”/“包含敏感内容已拦截”】
* 媒体播放失败：视频/音频错误是否提供“重试/反馈”按钮？【提供】

---

如果以上默认都 OK，你回我“**Step1 细节 OK**（或逐条改动）”，我就把这些规则固化到**交互规约**里，然后继续 **Step 2：Directus 数据模型**（`comments` 表的字段、索引、计数冗余、like/unlike 反应表等），这样前后端可以同步开工。
